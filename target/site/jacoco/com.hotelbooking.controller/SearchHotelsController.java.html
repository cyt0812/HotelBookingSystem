<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="zh"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SearchHotelsController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">HotelBookingSystem</a> &gt; <a href="index.source.html" class="el_package">com.hotelbooking.controller</a> &gt; <span class="el_source">SearchHotelsController.java</span></div><h1>SearchHotelsController.java</h1><pre class="source lang-java linenums">package com.hotelbooking.controller;

import com.hotelbooking.dao.HotelDAO;
import com.hotelbooking.entity.Hotel;
import com.hotelbooking.service.HotelService;
import com.hotelbooking.util.NavigationManager;
import com.hotelbooking.util.SessionManager;
import javafx.fxml.FXML;
import javafx.fxml.FXMLLoader;
import javafx.geometry.Insets;
import javafx.geometry.Pos;
import javafx.scene.Parent;
import javafx.scene.Scene;
import javafx.scene.control.*;
import javafx.scene.layout.*;
import javafx.stage.Stage;
import java.util.List;

<span class="nc" id="L19">public class SearchHotelsController {</span>
    
    @FXML private TextField txtSearch;
    @FXML private Label lblResultCount;
    @FXML private VBox hotelListContainer;
    @FXML private Button btnLogin;
    
    private HotelService hotelService;
    
//    @FXML
//    public void initialize() {
//        System.out.println(&quot;âœ… é…’åº—æœç´¢é¡µé¢åˆå§‹åŒ–&quot;);
//        hotelService = new HotelService(); // âœ…â—ä¸€å®šç”¨æ— å‚æ„é€ 
//    }
    @FXML
    public void initialize() {
<span class="nc" id="L35">        System.out.println(&quot;âœ… é…’åº—æœç´¢é¡µé¢åˆå§‹åŒ–&quot;);</span>
<span class="nc" id="L36">        hotelService = new HotelService(); // âœ…â—ä¸€å®šç”¨æ— å‚æ„é€ </span>

        // é»˜è®¤æ˜¾ç¤ºå…¨éƒ¨é…’åº—
<span class="nc" id="L39">        List&lt;Hotel&gt; allHotels = hotelService.getAllHotels();</span>
<span class="nc" id="L40">        displayHotels(allHotels);</span>
<span class="nc" id="L41">    }</span>
    
    /**
     * å¤„ç†æœç´¢
     */
    @FXML
    private void handleSearch() {
<span class="nc" id="L48">        String keyword = txtSearch.getText().trim();</span>
<span class="nc" id="L49">        List&lt;Hotel&gt; results = hotelService.searchHotels(keyword);</span>
<span class="nc" id="L50">        displayHotels(results);</span>
<span class="nc" id="L51">    }</span>
    
    // â­â­ ä¸»ç•Œé¢ä¼ å…¥ keyword åï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•
    public void setSearchKeyword(String keyword) {
<span class="nc" id="L55">        System.out.println(&quot;ğŸ” æ”¶åˆ° keyword: &quot; + keyword);</span>

        List&lt;Hotel&gt; results;
<span class="nc bnc" id="L58" title="All 4 branches missed.">        if (keyword == null || keyword.isEmpty()) {</span>
<span class="nc" id="L59">            results = hotelService.getAllHotels();</span>
        } else {
<span class="nc" id="L61">            results = hotelService.searchHotels(keyword);</span>
        }

<span class="nc" id="L64">        displayHotels(results);</span>
<span class="nc" id="L65">    }</span>
    
    /**
     * æ˜¾ç¤ºé…’åº—åˆ—è¡¨
     */
    private void displayHotels(List&lt;Hotel&gt; hotels) {
<span class="nc" id="L71">        hotelListContainer.getChildren().clear();</span>
        
        // æ›´æ–°ç»“æœæ•°é‡
<span class="nc bnc" id="L74" title="All 2 branches missed.">        lblResultCount.setText(&quot;Found &quot; + hotels.size() + &quot; hotel&quot; + (hotels.size() != 1 ? &quot;s&quot; : &quot;&quot;));</span>
        
<span class="nc bnc" id="L76" title="All 2 branches missed.">        if (hotels.isEmpty()) {</span>
<span class="nc" id="L77">            Label noResults = new Label(&quot;No hotels found. Try a different search.&quot;);</span>
<span class="nc" id="L78">            noResults.setStyle(&quot;-fx-font-size: 16px; -fx-text-fill: #666;&quot;);</span>
<span class="nc" id="L79">            hotelListContainer.getChildren().add(noResults);</span>
<span class="nc" id="L80">            return;</span>
        }
        
        // ä¸ºæ¯ä¸ªé…’åº—åˆ›å»ºå¡ç‰‡
<span class="nc bnc" id="L84" title="All 2 branches missed.">        for (Hotel hotel : hotels) {</span>
<span class="nc" id="L85">            VBox hotelCard = createHotelCard(hotel);</span>
<span class="nc" id="L86">            hotelListContainer.getChildren().add(hotelCard);</span>
<span class="nc" id="L87">        }</span>
<span class="nc" id="L88">    }</span>
    
    /**
     * åˆ›å»ºé…’åº—å¡ç‰‡
     */
    private VBox createHotelCard(Hotel hotel) {
<span class="nc" id="L94">        VBox card = new VBox(15);</span>
<span class="nc" id="L95">        card.setStyle(</span>
            &quot;-fx-background-color: white; &quot; +
            &quot;-fx-border-radius: 10; &quot; +
            &quot;-fx-background-radius: 10; &quot; +
            &quot;-fx-padding: 20; &quot; +
            &quot;-fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 2); &quot; +
            &quot;-fx-cursor: hand;&quot;
        );
        
        // é¼ æ ‡æ‚¬åœæ•ˆæœ
<span class="nc" id="L105">        card.setOnMouseEntered(e -&gt; {</span>
<span class="nc" id="L106">            card.setStyle(</span>
                &quot;-fx-background-color: white; &quot; +
                &quot;-fx-border-radius: 10; &quot; +
                &quot;-fx-background-radius: 10; &quot; +
                &quot;-fx-padding: 20; &quot; +
                &quot;-fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.2), 15, 0, 0, 3); &quot; +
                &quot;-fx-cursor: hand;&quot;
            );
<span class="nc" id="L114">        });</span>
        
<span class="nc" id="L116">        card.setOnMouseExited(e -&gt; {</span>
<span class="nc" id="L117">            card.setStyle(</span>
                &quot;-fx-background-color: white; &quot; +
                &quot;-fx-border-radius: 10; &quot; +
                &quot;-fx-background-radius: 10; &quot; +
                &quot;-fx-padding: 20; &quot; +
                &quot;-fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 2); &quot; +
                &quot;-fx-cursor: hand;&quot;
            );
<span class="nc" id="L125">        });</span>
        
        // é…’åº—åç§°
<span class="nc" id="L128">        Label lblName = new Label(hotel.getName());</span>
<span class="nc" id="L129">        lblName.setStyle(&quot;-fx-font-size: 22px; -fx-font-weight: bold; -fx-text-fill: #1a1a1a;&quot;);</span>
        
        // åœ°å€
<span class="nc" id="L132">        HBox addressBox = new HBox(5);</span>
<span class="nc" id="L133">        addressBox.setAlignment(Pos.CENTER_LEFT);</span>
<span class="nc" id="L134">        Label iconAddress = new Label(&quot;ğŸ“&quot;);</span>
<span class="nc" id="L135">        Label lblAddress = new Label(hotel.getAddress());</span>
<span class="nc" id="L136">        lblAddress.setStyle(&quot;-fx-font-size: 14px; -fx-text-fill: #666;&quot;);</span>
<span class="nc" id="L137">        addressBox.getChildren().addAll(iconAddress, lblAddress);</span>
        
        // æè¿°
<span class="nc" id="L140">        Label lblDescription = new Label(hotel.getDescription());</span>
<span class="nc" id="L141">        lblDescription.setStyle(&quot;-fx-font-size: 14px; -fx-text-fill: #555;&quot;);</span>
<span class="nc" id="L142">        lblDescription.setWrapText(true);</span>
        
        // è®¾æ–½
<span class="nc" id="L145">        HBox amenitiesBox = new HBox(5);</span>
<span class="nc" id="L146">        amenitiesBox.setAlignment(Pos.CENTER_LEFT);</span>
<span class="nc" id="L147">        Label iconAmenities = new Label(&quot;âœ¨&quot;);</span>
<span class="nc" id="L148">        Label lblAmenities = new Label(hotel.getAmenities());</span>
<span class="nc" id="L149">        lblAmenities.setStyle(&quot;-fx-font-size: 13px; -fx-text-fill: #777;&quot;);</span>
<span class="nc" id="L150">        lblAmenities.setWrapText(true);</span>
<span class="nc" id="L151">        amenitiesBox.getChildren().addAll(iconAmenities, lblAmenities);</span>
        
        // åº•éƒ¨ï¼šä»·æ ¼å’ŒæŸ¥çœ‹è¯¦æƒ…æŒ‰é’®
<span class="nc" id="L154">        HBox bottomBox = new HBox(20);</span>
<span class="nc" id="L155">        bottomBox.setAlignment(Pos.CENTER_LEFT);</span>
<span class="nc" id="L156">        HBox.setHgrow(bottomBox, Priority.ALWAYS);</span>
        
        // ä»·æ ¼ä¿¡æ¯
<span class="nc" id="L159">        VBox priceBox = new VBox(2);</span>
<span class="nc" id="L160">        priceBox.setAlignment(Pos.CENTER_LEFT);</span>
<span class="nc" id="L161">        Label lblFromPrice = new Label(&quot;From&quot;);</span>
<span class="nc" id="L162">        lblFromPrice.setStyle(&quot;-fx-font-size: 12px; -fx-text-fill: #999;&quot;);</span>
        
//        double minPrice = hotelService.getMinPrice(hotel.getHotelId());
//        Label lblPrice = new Label(&quot;$&quot; + String.format(&quot;%.0f&quot;, minPrice));
//        lblPrice.setStyle(&quot;-fx-font-size: 28px; -fx-font-weight: bold; -fx-text-fill: #8B4513;&quot;);
        
<span class="nc" id="L168">        Label lblPerNight = new Label(&quot;per night&quot;);</span>
<span class="nc" id="L169">        lblPerNight.setStyle(&quot;-fx-font-size: 12px; -fx-text-fill: #999;&quot;);</span>
        
//        priceBox.getChildren().addAll(lblFromPrice, lblPrice, lblPerNight);
        
        // æŸ¥çœ‹è¯¦æƒ…æŒ‰é’®
<span class="nc" id="L174">        Region spacer = new Region();</span>
<span class="nc" id="L175">        HBox.setHgrow(spacer, Priority.ALWAYS);</span>
        
<span class="nc" id="L177">        Button btnViewRooms = new Button(&quot;View Rooms&quot;);</span>
<span class="nc" id="L178">        btnViewRooms.setStyle(</span>
            &quot;-fx-background-color: #8B4513; &quot; +
            &quot;-fx-text-fill: white; &quot; +
            &quot;-fx-font-size: 16px; &quot; +
            &quot;-fx-font-weight: bold; &quot; +
            &quot;-fx-padding: 12 30; &quot; +
            &quot;-fx-border-radius: 5; &quot; +
            &quot;-fx-background-radius: 5; &quot; +
            &quot;-fx-cursor: hand;&quot;
        );
        
<span class="nc" id="L189">        btnViewRooms.setOnAction(e -&gt; viewHotelRooms(hotel));</span>
        
<span class="nc" id="L191">        bottomBox.getChildren().addAll(priceBox, spacer, btnViewRooms);</span>
        
        // æ·»åŠ æ‰€æœ‰å…ƒç´ åˆ°å¡ç‰‡
<span class="nc" id="L194">        card.getChildren().addAll(</span>
            lblName,
            addressBox,
            lblDescription,
            amenitiesBox,
            new Separator(),
            bottomBox
        );
        
<span class="nc" id="L203">        return card;</span>
    }
    
    /**
     * æŸ¥çœ‹é…’åº—æˆ¿é—´
     */
    private void viewHotelRooms(Hotel hotel) {
        try {
<span class="nc" id="L211">            System.out.println(&quot;ğŸ¨ æŸ¥çœ‹é…’åº—æˆ¿é—´: &quot; + hotel.getName());</span>
            
<span class="nc" id="L213">            SessionManager.setCurrentHotel(hotel);  // è®¾ç½®å½“å‰é…’åº—ä¿¡æ¯</span>

            
            // åœ¨ä»»ä½•å¯¼èˆªå‰è°ƒç”¨
<span class="nc" id="L217">            NavigationManager.getInstance().push(</span>
                &quot;/com/hotelbooking/view/hotel_rooms.fxml&quot;,
                &quot;Hotel Rooms&quot;
            );
            
<span class="nc" id="L222">            FXMLLoader loader = new FXMLLoader(</span>
<span class="nc" id="L223">                getClass().getResource(&quot;/com/hotelbooking/view/hotel_rooms.fxml&quot;)</span>
            );
<span class="nc" id="L225">            Parent root = loader.load();</span>
            
            
            // ä¼ é€’é…’åº—ä¿¡æ¯ç»™æˆ¿é—´é¡µé¢
<span class="nc" id="L229">            HotelRoomsController controller = loader.getController();</span>
<span class="nc" id="L230">            controller.setHotel(hotel);</span>
            
<span class="nc" id="L232">            Stage stage = (Stage) hotelListContainer.getScene().getWindow();</span>
<span class="nc" id="L233">            stage.setScene(new Scene(root));</span>
<span class="nc" id="L234">            stage.setTitle(&quot;Hotel Rooms - &quot; + hotel.getName());</span>
            
<span class="nc" id="L236">        } catch (Exception e) {</span>
<span class="nc" id="L237">            System.err.println(&quot;âŒ åŠ è½½æˆ¿é—´é¡µé¢å¤±è´¥: &quot; + e.getMessage());</span>
<span class="nc" id="L238">            e.printStackTrace();</span>
<span class="nc" id="L239">        }</span>
<span class="nc" id="L240">    }</span>
    
    /**
     * è¿”å›ä¸»é¡µ
     */
    @FXML
    private void backToHome() {
        try {
<span class="nc" id="L248">            FXMLLoader loader = new FXMLLoader(</span>
<span class="nc" id="L249">                getClass().getResource(&quot;/com/hotelbooking/view/main_dashboard.fxml&quot;)</span>
            );
<span class="nc" id="L251">            Parent root = loader.load();</span>
            
<span class="nc" id="L253">            Stage stage = (Stage) hotelListContainer.getScene().getWindow();</span>
<span class="nc" id="L254">            stage.setScene(new Scene(root));</span>
<span class="nc" id="L255">            stage.setTitle(&quot;Hotel Booking System&quot;);</span>
            
<span class="nc" id="L257">        } catch (Exception e) {</span>
<span class="nc" id="L258">            e.printStackTrace();</span>
<span class="nc" id="L259">        }</span>
<span class="nc" id="L260">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>