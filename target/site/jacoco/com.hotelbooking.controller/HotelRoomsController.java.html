<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="zh"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>HotelRoomsController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">HotelBookingSystem</a> &gt; <a href="index.source.html" class="el_package">com.hotelbooking.controller</a> &gt; <span class="el_source">HotelRoomsController.java</span></div><h1>HotelRoomsController.java</h1><pre class="source lang-java linenums">package com.hotelbooking.controller;

import com.hotelbooking.dao.HotelDAO;
import com.hotelbooking.entity.Hotel;
import com.hotelbooking.entity.Room;
import com.hotelbooking.service.HotelService;
import com.hotelbooking.util.NavigationManager;
import com.hotelbooking.util.SessionManager;
import javafx.fxml.FXML;
import javafx.fxml.FXMLLoader;
import javafx.geometry.Pos;
import javafx.scene.Parent;
import javafx.scene.Scene;
import javafx.scene.control.*;
import javafx.scene.layout.*;
import javafx.stage.Stage;
import java.util.List;

<span class="nc" id="L19">public class HotelRoomsController {</span>
    
    @FXML private Label lblHotelName;
    @FXML private Label lblHotelAddress;
    @FXML private Label lblHotelDescription;
    @FXML private Label lblHotelAmenities;
    @FXML private Label lblRoomCount;
    @FXML private VBox roomListContainer;
    
    @FXML
    public void initialize() {
        // ä» SessionManager è·å–å½“å‰é…’åº—ä¿¡æ¯
<span class="nc" id="L31">        currentHotel = SessionManager.getCurrentHotel();</span>

        // å¦‚æœå½“å‰é…’åº—ä¸ä¸ºç©ºï¼Œåˆ™æ˜¾ç¤ºé…’åº—ä¿¡æ¯å’Œæˆ¿é—´ä¿¡æ¯
<span class="nc bnc" id="L34" title="All 2 branches missed.">        if (currentHotel != null) {</span>
<span class="nc" id="L35">            displayHotelInfo();  // æ˜¾ç¤ºé…’åº—ä¿¡æ¯</span>
<span class="nc" id="L36">            displayRooms();      // æ˜¾ç¤ºæˆ¿é—´ä¿¡æ¯</span>
        } else {
            // å¦‚æœæ²¡æœ‰é…’åº—ä¿¡æ¯ï¼Œåˆ™æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯æˆ–è¿›è¡Œå…¶ä»–å¤„ç†
<span class="nc" id="L39">            Alert alert = new Alert(Alert.AlertType.ERROR);</span>
<span class="nc" id="L40">            alert.setTitle(&quot;Error&quot;);</span>
<span class="nc" id="L41">            alert.setHeaderText(&quot;Hotel Information Missing&quot;);</span>
<span class="nc" id="L42">            alert.setContentText(&quot;The hotel information could not be loaded. Please go back and try again.&quot;);</span>
<span class="nc" id="L43">            alert.showAndWait();</span>
        }
<span class="nc" id="L45">    }</span>
    
//    private HotelService hotelService = new HotelService();
    private Hotel currentHotel;
    
    /**
     * è®¾ç½®é…’åº—ä¿¡æ¯
     */
    public void setHotel(Hotel hotel) {
<span class="nc" id="L54">        this.currentHotel = hotel;</span>
<span class="nc" id="L55">        displayHotelInfo();</span>
<span class="nc" id="L56">        displayRooms();</span>
<span class="nc" id="L57">    }</span>
    
    /**
     * æ˜¾ç¤ºé…’åº—ä¿¡æ¯
     */
    private void displayHotelInfo() {
<span class="nc bnc" id="L63" title="All 2 branches missed.">        if (currentHotel == null) return;</span>
        
<span class="nc" id="L65">        lblHotelName.setText(currentHotel.getName());</span>
<span class="nc" id="L66">        lblHotelAddress.setText(currentHotel.getAddress());</span>
<span class="nc" id="L67">        lblHotelDescription.setText(currentHotel.getDescription());</span>
<span class="nc" id="L68">        lblHotelAmenities.setText(currentHotel.getAmenities());</span>
<span class="nc" id="L69">    }</span>
    
    /**
     * æ˜¾ç¤ºæˆ¿å‹åˆ—è¡¨
     */
    private void displayRooms() {
<span class="nc bnc" id="L75" title="All 2 branches missed.">        if (currentHotel == null) return;</span>
        
<span class="nc" id="L77">        System.out.println(&quot;âœ… Current hotel ID = &quot; + currentHotel.getId());</span>
        
        // å‡è®¾ä½ å·²ç»æœ‰äº†ä¸€ä¸ª DatabaseConnection ç±»æ¥è·å–æ•°æ®åº“è¿æ¥
<span class="nc" id="L80">        HotelDAO hotelDAO = new HotelDAO();  // åˆ›å»º HotelDAO å®ä¾‹</span>

        // åˆ›å»º HotelService å®ä¾‹
<span class="nc" id="L83">        HotelService hotelService = new HotelService(hotelDAO);</span>

        
        // é€šè¿‡å®ä¾‹è°ƒç”¨ getRoomsByHotelId æ–¹æ³•
<span class="nc" id="L87">        List&lt;Room&gt; rooms = hotelService.getRoomsByHotelId(currentHotel.getId());</span>
<span class="nc bnc" id="L88" title="All 2 branches missed.">        lblRoomCount.setText(&quot;(&quot; + rooms.size() + &quot; room&quot; + (rooms.size() != 1 ? &quot;s&quot; : &quot;&quot;) + &quot;)&quot;);</span>
        
<span class="nc" id="L90">        roomListContainer.getChildren().clear();</span>
        
<span class="nc bnc" id="L92" title="All 2 branches missed.">        if (rooms.isEmpty()) {</span>
<span class="nc" id="L93">            Label noRooms = new Label(&quot;No rooms available at the moment.&quot;);</span>
<span class="nc" id="L94">            noRooms.setStyle(&quot;-fx-font-size: 16px; -fx-text-fill: #666;&quot;);</span>
<span class="nc" id="L95">            roomListContainer.getChildren().add(noRooms);</span>
<span class="nc" id="L96">            return;</span>
        }
        
<span class="nc bnc" id="L99" title="All 2 branches missed.">        for (Room room : rooms) {</span>
<span class="nc" id="L100">            VBox roomCard = createRoomCard(room);</span>
<span class="nc" id="L101">            roomListContainer.getChildren().add(roomCard);</span>
<span class="nc" id="L102">        }</span>
<span class="nc" id="L103">    }</span>
    
    /**
     * åˆ›å»ºæˆ¿é—´å¡ç‰‡
     */
    private VBox createRoomCard(Room room) {
<span class="nc" id="L109">        VBox card = new VBox(15);</span>
<span class="nc" id="L110">        card.setStyle(</span>
            &quot;-fx-background-color: white; &quot; +
            &quot;-fx-border-radius: 10; &quot; +
            &quot;-fx-background-radius: 10; &quot; +
            &quot;-fx-padding: 25; &quot; +
            &quot;-fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 2);&quot;
        );
        
        // é¡¶éƒ¨ï¼šæˆ¿å‹åç§°å’Œå¯ç”¨çŠ¶æ€
<span class="nc" id="L119">        HBox topBox = new HBox(15);</span>
<span class="nc" id="L120">        topBox.setAlignment(Pos.CENTER_LEFT);</span>
        
<span class="nc" id="L122">        Label lblRoomType = new Label(room.getRoomType());</span>
<span class="nc" id="L123">        lblRoomType.setStyle(&quot;-fx-font-size: 22px; -fx-font-weight: bold; -fx-text-fill: #1a1a1a;&quot;);</span>
        
<span class="nc" id="L125">        Region spacer1 = new Region();</span>
<span class="nc" id="L126">        HBox.setHgrow(spacer1, Priority.ALWAYS);</span>
        
        // å¯ç”¨çŠ¶æ€æ ‡ç­¾
<span class="nc bnc" id="L129" title="All 2 branches missed.">        Label lblStatus = new Label(room.isAvailable() ? &quot;âœ“ Available&quot; : &quot;âœ— Unavailable&quot;);</span>
<span class="nc" id="L130">        lblStatus.setStyle(</span>
            &quot;-fx-font-size: 14px; &quot; +
            &quot;-fx-font-weight: bold; &quot; +
<span class="nc bnc" id="L133" title="All 2 branches missed.">            &quot;-fx-text-fill: &quot; + (room.isAvailable() ? &quot;#28a745&quot; : &quot;#dc3545&quot;) + &quot;; &quot; +</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">            &quot;-fx-background-color: &quot; + (room.isAvailable() ? &quot;#d4edda&quot; : &quot;#f8d7da&quot;) + &quot;; &quot; +</span>
            &quot;-fx-padding: 5 15; &quot; +
            &quot;-fx-border-radius: 15; &quot; +
            &quot;-fx-background-radius: 15;&quot;
        );
        
<span class="nc" id="L140">        topBox.getChildren().addAll(lblRoomType, spacer1, lblStatus);</span>
        
        // æˆ¿é—´ä¿¡æ¯
<span class="nc" id="L143">        HBox infoBox = new HBox(30);</span>
<span class="nc" id="L144">        infoBox.setAlignment(Pos.CENTER_LEFT);</span>
        
        // æˆ¿é—´å·
<span class="nc" id="L147">        VBox roomNumberBox = new VBox(3);</span>
<span class="nc" id="L148">        Label lblRoomNumberTitle = new Label(&quot;Room Number&quot;);</span>
<span class="nc" id="L149">        lblRoomNumberTitle.setStyle(&quot;-fx-font-size: 12px; -fx-text-fill: #999;&quot;);</span>
<span class="nc" id="L150">        Label lblRoomNumber = new Label(room.getRoomNumber());</span>
<span class="nc" id="L151">        lblRoomNumber.setStyle(&quot;-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #333;&quot;);</span>
<span class="nc" id="L152">        roomNumberBox.getChildren().addAll(lblRoomNumberTitle, lblRoomNumber);</span>
        
        // æœ€å¤§å…¥ä½äººæ•°
<span class="nc" id="L155">        VBox occupancyBox = new VBox(3);</span>
<span class="nc" id="L156">        Label lblOccupancyTitle = new Label(&quot;Max Occupancy&quot;);</span>
<span class="nc" id="L157">        lblOccupancyTitle.setStyle(&quot;-fx-font-size: 12px; -fx-text-fill: #999;&quot;);</span>
<span class="nc" id="L158">        Label lblOccupancy = new Label(&quot;ğŸ‘¥ &quot; + room.getMaxOccupancy() + &quot; guests&quot;);</span>
<span class="nc" id="L159">        lblOccupancy.setStyle(&quot;-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #333;&quot;);</span>
<span class="nc" id="L160">        occupancyBox.getChildren().addAll(lblOccupancyTitle, lblOccupancy);</span>
        
<span class="nc" id="L162">        infoBox.getChildren().addAll(roomNumberBox, occupancyBox);</span>
        
        // åˆ†éš”çº¿
<span class="nc" id="L165">        Separator separator = new Separator();</span>
        
        // åº•éƒ¨ï¼šä»·æ ¼å’Œé¢„è®¢æŒ‰é’®
<span class="nc" id="L168">        HBox bottomBox = new HBox(20);</span>
<span class="nc" id="L169">        bottomBox.setAlignment(Pos.CENTER_LEFT);</span>
        
        // ä»·æ ¼ä¿¡æ¯
<span class="nc" id="L172">        VBox priceBox = new VBox(3);</span>
<span class="nc" id="L173">        priceBox.setAlignment(Pos.CENTER_LEFT);</span>
        
<span class="nc" id="L175">        Label lblPrice = new Label(&quot;$&quot; + String.format(&quot;%.2f&quot;, room.getPricePerNight()));</span>
<span class="nc" id="L176">        lblPrice.setStyle(&quot;-fx-font-size: 32px; -fx-font-weight: bold; -fx-text-fill: #8B4513;&quot;);</span>
        
<span class="nc" id="L178">        Label lblPerNight = new Label(&quot;per night&quot;);</span>
<span class="nc" id="L179">        lblPerNight.setStyle(&quot;-fx-font-size: 14px; -fx-text-fill: #999;&quot;);</span>
        
<span class="nc" id="L181">        priceBox.getChildren().addAll(lblPrice, lblPerNight);</span>
        
        // å ä½ç¬¦
<span class="nc" id="L184">        Region spacer2 = new Region();</span>
<span class="nc" id="L185">        HBox.setHgrow(spacer2, Priority.ALWAYS);</span>
        
        // é¢„è®¢æŒ‰é’®
<span class="nc bnc" id="L188" title="All 2 branches missed.">        Button btnBook = new Button(room.isAvailable() ? &quot;Book Now&quot; : &quot;Unavailable&quot;);</span>
<span class="nc bnc" id="L189" title="All 2 branches missed.">        btnBook.setDisable(!room.isAvailable());</span>
<span class="nc" id="L190">        btnBook.setStyle(</span>
<span class="nc bnc" id="L191" title="All 2 branches missed.">            &quot;-fx-background-color: &quot; + (room.isAvailable() ? &quot;#8B4513&quot; : &quot;#cccccc&quot;) + &quot;; &quot; +</span>
            &quot;-fx-text-fill: white; &quot; +
            &quot;-fx-font-size: 16px; &quot; +
            &quot;-fx-font-weight: bold; &quot; +
            &quot;-fx-padding: 12 40; &quot; +
            &quot;-fx-border-radius: 5; &quot; +
            &quot;-fx-background-radius: 5; &quot; +
<span class="nc bnc" id="L198" title="All 2 branches missed.">            &quot;-fx-cursor: &quot; + (room.isAvailable() ? &quot;hand&quot; : &quot;default&quot;) + &quot;;&quot;</span>
        );
        
<span class="nc bnc" id="L201" title="All 2 branches missed.">        if (room.isAvailable()) {</span>
<span class="nc" id="L202">            btnBook.setOnAction(e -&gt; bookRoom(room));</span>
            
            // æ‚¬åœæ•ˆæœ
<span class="nc" id="L205">            btnBook.setOnMouseEntered(e -&gt; {</span>
<span class="nc" id="L206">                btnBook.setStyle(</span>
                    &quot;-fx-background-color: #6d3410; &quot; +
                    &quot;-fx-text-fill: white; &quot; +
                    &quot;-fx-font-size: 16px; &quot; +
                    &quot;-fx-font-weight: bold; &quot; +
                    &quot;-fx-padding: 12 40; &quot; +
                    &quot;-fx-border-radius: 5; &quot; +
                    &quot;-fx-background-radius: 5; &quot; +
                    &quot;-fx-cursor: hand;&quot;
                );
<span class="nc" id="L216">            });</span>
            
<span class="nc" id="L218">            btnBook.setOnMouseExited(e -&gt; {</span>
<span class="nc" id="L219">                btnBook.setStyle(</span>
                    &quot;-fx-background-color: #8B4513; &quot; +
                    &quot;-fx-text-fill: white; &quot; +
                    &quot;-fx-font-size: 16px; &quot; +
                    &quot;-fx-font-weight: bold; &quot; +
                    &quot;-fx-padding: 12 40; &quot; +
                    &quot;-fx-border-radius: 5; &quot; +
                    &quot;-fx-background-radius: 5; &quot; +
                    &quot;-fx-cursor: hand;&quot;
                );
<span class="nc" id="L229">            });</span>
        }
        
<span class="nc" id="L232">        bottomBox.getChildren().addAll(priceBox, spacer2, btnBook);</span>
        
        // ç»„è£…å¡ç‰‡
<span class="nc" id="L235">        card.getChildren().addAll(</span>
            topBox,
            infoBox,
            separator,
            bottomBox
        );
        
<span class="nc" id="L242">        return card;</span>
    }
    
    /**
     * é¢„è®¢æˆ¿é—´
     */
    private void bookRoom(Room room) {
<span class="nc" id="L249">        System.out.println(&quot;ğŸ« Booking room: &quot; + room.getRoomType() + &quot; - &quot; + room.getRoomNumber());</span>
        
        // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
<span class="nc" id="L252">        Alert alert = new Alert(Alert.AlertType.CONFIRMATION);</span>
<span class="nc" id="L253">        alert.setTitle(&quot;Confirm Booking&quot;);</span>
<span class="nc" id="L254">        alert.setHeaderText(&quot;Book &quot; + room.getRoomType() + &quot;?&quot;);</span>
<span class="nc" id="L255">        alert.setContentText(</span>
<span class="nc" id="L256">            &quot;Room: &quot; + room.getRoomNumber() + &quot;\n&quot; +</span>
<span class="nc" id="L257">            &quot;Hotel: &quot; + currentHotel.getName() + &quot;\n&quot; +</span>
<span class="nc" id="L258">            &quot;Price: $&quot; + String.format(&quot;%.2f&quot;, room.getPricePerNight()) + &quot; per night\n\n&quot; +</span>
            &quot;Proceed to payment?&quot;
        );
        
<span class="nc" id="L262">        alert.showAndWait().ifPresent(response -&gt; {</span>
<span class="nc bnc" id="L263" title="All 2 branches missed.">            if (response == ButtonType.OK) {</span>
                // è·³è½¬åˆ°æ”¯ä»˜é¡µé¢
<span class="nc" id="L265">                navigateToPayment(room);</span>
            }
<span class="nc" id="L267">        });</span>
<span class="nc" id="L268">    }</span>
    
    /**
     * è·³è½¬åˆ°æ”¯ä»˜é¡µé¢
     */
    private void navigateToPayment(Room room) {
        try {
            // åœ¨ä»»ä½•å¯¼èˆªå‰è°ƒç”¨
<span class="nc" id="L276">            NavigationManager.getInstance().push(</span>
                &quot;/com/hotelbooking/view/payment.fxml&quot;,  // â† è¦å¯¼èˆªåˆ°çš„é¡µé¢
                &quot;Payment&quot;
            );
<span class="nc" id="L280">            System.out.println(&quot;ğŸ’³ Navigating to payment page&quot;);</span>
            
<span class="nc" id="L282">            FXMLLoader loader = new FXMLLoader(</span>
<span class="nc" id="L283">                getClass().getResource(&quot;/com/hotelbooking/view/payment.fxml&quot;)</span>
            );
<span class="nc" id="L285">            Parent root = loader.load();</span>
            
            // ä¼ é€’é¢„è®¢ä¿¡æ¯ç»™æ”¯ä»˜é¡µé¢
<span class="nc" id="L288">             PaymentController controller = loader.getController();</span>
<span class="nc" id="L289">            controller.setBookingInfo(currentHotel, room);</span>
            
<span class="nc" id="L291">            Stage stage = (Stage) roomListContainer.getScene().getWindow();</span>
<span class="nc" id="L292">            stage.setScene(new Scene(root));</span>
<span class="nc" id="L293">            stage.setTitle(&quot;Payment - &quot; + currentHotel.getName());</span>
            
<span class="nc" id="L295">            System.out.println(&quot;âœ… Navigation successful&quot;);</span>
            
<span class="nc" id="L297">        } catch (Exception e) {</span>
<span class="nc" id="L298">            System.err.println(&quot;âŒ Failed to navigate to payment page: &quot; + e.getMessage());</span>
<span class="nc" id="L299">            e.printStackTrace();</span>
            
<span class="nc" id="L301">            Alert errorAlert = new Alert(Alert.AlertType.ERROR);</span>
<span class="nc" id="L302">            errorAlert.setTitle(&quot;Error&quot;);</span>
<span class="nc" id="L303">            errorAlert.setHeaderText(&quot;Navigation Failed&quot;);</span>
<span class="nc" id="L304">            errorAlert.setContentText(&quot;Unable to open payment page. Please try again.&quot;);</span>
<span class="nc" id="L305">            errorAlert.showAndWait();</span>
<span class="nc" id="L306">        }</span>
<span class="nc" id="L307">    }</span>
    
    /**
     * è¿”å›æœç´¢é¡µé¢
     */
    @FXML
    private void backToSearch() {
        try {
<span class="nc" id="L315">            FXMLLoader loader = new FXMLLoader(</span>
<span class="nc" id="L316">                getClass().getResource(&quot;/com/hotelbooking/view/search_hotels.fxml&quot;)</span>
            );
<span class="nc" id="L318">            Parent root = loader.load();</span>
            
<span class="nc" id="L320">            Stage stage = (Stage) roomListContainer.getScene().getWindow();</span>
<span class="nc" id="L321">            stage.setScene(new Scene(root));</span>
<span class="nc" id="L322">            stage.setTitle(&quot;Hotel Search&quot;);</span>
            
<span class="nc" id="L324">        } catch (Exception e) {</span>
<span class="nc" id="L325">            System.err.println(&quot;âŒ è¿”å›æœç´¢é¡µé¢å¤±è´¥: &quot; + e.getMessage());</span>
<span class="nc" id="L326">            e.printStackTrace();</span>
<span class="nc" id="L327">        }</span>
<span class="nc" id="L328">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>